<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>POL/USDT Price â€” On-Chain Arbitrage Checker</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      color: #333;
      text-align: center;
      margin-top: 50px;
    }
    button {
      background: #6200ee;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
    }
    button:hover {
      background: #4500b5;
    }
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: inline-block;
      padding: 20px;
      margin-top: 20px;
      min-width: 300px;
    }
  </style>
</head>
<body>
  <h2>ðŸ”— POL / USDT â€” On-Chain Price Comparator</h2>
  <p>Compare prices from QuickSwap & SushiSwap directly on Polygon blockchain</p>

  <button id="connect">Connect MetaMask</button>
  <button id="check">Check Prices</button>

  <div class="card">
    <h3>QuickSwap</h3>
    <p id="quickPrice">-</p>
  </div>

  <div class="card">
    <h3>SushiSwap</h3>
    <p id="sushiPrice">-</p>
  </div>

  <div class="card" style="background:#eef7ff;">
    <h3>ðŸ“ˆ Potential Arbitrage</h3>
    <p id="diff">-</p>
  </div>

  <script>
    const QUICKSWAP_ROUTER = "0xa5E0829CaCEd8fFDD4De3c43696c57F7D7A678ff";
    const SUSHISWAP_ROUTER = "0x1b02da8cb0d097eb8d57a175b88c7d8b47997506";
    const WPOL = "0xA9C1255D8A4877d1E9a2b7Dc9d8f27E67F4E3Ee7";
    const USDT = "0xc2132D05D31c914a87C6611C10748AEb04B58e8F";

    const ABI = [
      "function getAmountsOut(uint amountIn, address[] calldata path) external view returns (uint[] memory amounts)"
    ];

    let provider;
    let signer;

    // Hubungkan MetaMask
    document.getElementById("connect").onclick = async () => {
      if (!window.ethereum) return alert("Please install MetaMask first.");
      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      const address = await signer.getAddress();
      alert("Connected: " + address);
    };

    // Cek harga POL/USDT
    document.getElementById("check").onclick = async () => {
      if (!provider) return alert("Please connect MetaMask first.");
      try {
        const routerQuick = new ethers.Contract(QUICKSWAP_ROUTER, ABI, provider);
        const routerSushi = new ethers.Contract(SUSHISWAP_ROUTER, ABI, provider);

        const amountIn = ethers.utils.parseUnits("1", 18); // 1 POL
        const path = [WPOL, USDT];

        // Ambil harga QuickSwap
        const quickAmounts = await routerQuick.getAmountsOut(amountIn, path);
        const quickPrice = Number(ethers.utils.formatUnits(quickAmounts[1], 6));

        // Ambil harga SushiSwap
        const sushiAmounts = await routerSushi.getAmountsOut(amountIn, path);
        const sushiPrice = Number(ethers.utils.formatUnits(sushiAmounts[1], 6));

        // Hitung selisih
        const diff = ((quickPrice - sushiPrice) / sushiPrice) * 100;

        // Tampilkan hasil
        document.getElementById("quickPrice").innerText = `1 POL = ${quickPrice.toFixed(4)} USDT`;
        document.getElementById("sushiPrice").innerText = `1 POL = ${sushiPrice.toFixed(4)} USDT`;
        document.getElementById("diff").innerText =
          `Difference: ${diff.toFixed(3)}% (${diff > 0 ? "QuickSwap higher" : "SushiSwap higher"})`;

      } catch (err) {
        console.error(err);
        alert("Error fetching prices. Check network or try again.");
      }
    };
  </script>
</body>
</html>
