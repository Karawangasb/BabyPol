<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Simulasi Arbitrase 1inch (Polygon)</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f9; color: #222; padding: 20px; }
    h2 { color: #4f46e5; }
    button { background: #4f46e5; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; }
    button:hover { background: #3730a3; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background: #4f46e5; color: white; }
    tr:nth-child(even) { background: #f9f9f9; }
  </style>
</head>
<body>
  <h2>üîÅ Simulasi Arbitrase WMATIC ‚Üî USDT (via 1inch + CORS Proxy)</h2>
  <button onclick="checkPrices()">Cek Harga</button>
  <p id="loading"></p>

  <table id="priceTable">
    <thead>
      <tr><th>Arah Swap</th><th>Harga (Estimasi)</th><th>Sumber</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_KEY = "7gXrbGyk3Ax1epidXqOKF6k5LusH8LoR";
    const BASE_URL = "https://api.1inch.dev/swap/v5.2/137";
    const PROXY = "https://corsproxy.io/?"; // ‚úÖ solusi anti-CORS

    const TOKENS = {
      USDT: "0xc2132d05d31c914a87c6611c10748aeb04b58e8f",
      WMATIC: "0x0d500b1d8e8ef31e21c99d1db9a6444d3adf1270"
    };

    async function getQuote(from, to, amount) {
      try {
        const url = `${PROXY}${BASE_URL}/quote?fromTokenAddress=${from}&toTokenAddress=${to}&amount=${amount}`;
        const res = await axios.get(url, {
          headers: { Authorization: `Bearer ${API_KEY}` }
        });
        return res.data;
      } catch (err) {
        console.error(err);
        return null;
      }
    }

    async function checkPrices() {
      const tbody = document.querySelector("#priceTable tbody");
      const loading = document.getElementById("loading");
      tbody.innerHTML = "";
      loading.textContent = "‚è≥ Mengambil data harga dari 1inch...";

      const [usdtToMatic, maticToUsdt] = await Promise.all([
        getQuote(TOKENS.USDT, TOKENS.WMATIC, 1e6),  // 1 USDT
        getQuote(TOKENS.WMATIC, TOKENS.USDT, 1e18)  // 1 WMATIC
      ]);

      const rows = [];
      if (usdtToMatic) {
        rows.push({
          direction: "1 USDT ‚Üí WMATIC",
          price: (usdtToMatic.toTokenAmount / 1e18).toFixed(6),
          src: usdtToMatic.protocols?.[0]?.[0]?.name || "1inch"
        });
      }
      if (maticToUsdt) {
        rows.push({
          direction: "1 WMATIC ‚Üí USDT",
          price: (maticToUsdt.toTokenAmount / 1e6).toFixed(6),
          src: maticToUsdt.protocols?.[0]?.[0]?.name || "1inch"
        });
      }

      for (const row of rows) {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${row.direction}</td><td>${row.price}</td><td>${row.src}</td>`;
        tbody.appendChild(tr);
      }

      if (rows.length === 2) {
        const diff = (rows[1].price / (1 / rows[0].price) - 1) * 100;
        const tr = document.createElement("tr");
        tr.innerHTML = `<td colspan="3"><b>üí∞ Potensi Arbitrase:</b> ${diff.toFixed(2)}%</td>`;
        tbody.appendChild(tr);
      }

      loading.textContent = "‚úÖ Harga berhasil dimuat dari 1inch.";
    }
  </script>
</body>
</html>
