<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Multi-Token Price Checker ‚Äî Polygon DEX</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body style="font-family: Arial; margin: 20px;">
  <h2>ü™ô Multi-Token ‚Äî USDC Price Comparator (QuickSwap, SushiSwap, MeshSwap)</h2>
  <button id="check">Check Prices</button>
  <div id="result"></div>

  <script>
    const QUICKSWAP = "0xa5E0829CaCEd8fFDD4De3c43696c57F7D7A678ff";
    const SUSHISWAP = "0x1b02da8cb0d097eb8d57a175b88c7d8b47997506";
    const MESHSWAP  = "0x10f4A785F458Bc144e3706575924889954946639";
    const USDC      = "0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174";

    const tokens = [
      { name: "POL",  address: "0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270", decimals: 18 },
      { name: "USDT", address: "0xc2132D05D31c914a87C6611C10748AEb04B58e8F", decimals: 6 },
      { name: "DAI",  address: "0x8f3Cf7ad23Cd3CaDbD9735AFf958023239c6A063", decimals: 18 },
      { name: "WBTC", address: "0x1BFD67037B42Cf73acF2047067bd4F2C47D9BfD6", decimals: 8 }
    ];

    const ABI = [
      "function getAmountsOut(uint amountIn, address[] calldata path) external view returns (uint[] memory amounts)"
    ];

    const provider = new ethers.providers.JsonRpcProvider("https://polygon-rpc.com");
    const quick = new ethers.Contract(QUICKSWAP, ABI, provider);
    const sushi = new ethers.Contract(SUSHISWAP, ABI, provider);
    const mesh  = new ethers.Contract(MESHSWAP,  ABI, provider);

    document.getElementById("check").onclick = async () => {
      document.getElementById("result").innerHTML = "<p>‚è≥ Fetching prices...</p>";

      let html = "<table border='1' cellpadding='6' cellspacing='0'><tr><th>Token</th><th>QuickSwap</th><th>SushiSwap</th><th>MeshSwap</th></tr>";

      for (const t of tokens) {
        try {
          const amountIn = ethers.utils.parseUnits("1", t.decimals);
          const path = [t.address, USDC];

          const [q, s, m] = await Promise.all([
            quick.getAmountsOut(amountIn, path),
            sushi.getAmountsOut(amountIn, path),
            mesh.getAmountsOut(amountIn, path)
          ]);

          const quickPrice = parseFloat(ethers.utils.formatUnits(q[1], 6)).toFixed(4);
          const sushiPrice = parseFloat(ethers.utils.formatUnits(s[1], 6)).toFixed(4);
          const meshPrice  = parseFloat(ethers.utils.formatUnits(m[1], 6)).toFixed(4);

          html += `<tr>
            <td>${t.name}</td>
            <td>${quickPrice} USDC</td>
            <td>${sushiPrice} USDC</td>
            <td>${meshPrice} USDC</td>
          </tr>`;
        } catch (err) {
          html += `<tr>
            <td>${t.name}</td>
            <td colspan="3">‚ùå Tidak ada pool ke USDC</td>
          </tr>`;
        }
      }

      html += "</table>";
      document.getElementById("result").innerHTML = html;
    };
  </script>
</body>
</html>
