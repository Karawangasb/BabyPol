<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>POL/USDT Price — On-Chain Arbitrage Checker</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <h2>POL / USDT — On-Chain Price Comparator</h2>
  <button id="connect">Connect MetaMask</button>
  <button id="check">Check Prices</button>

  <div>
    <h3>QuickSwap: <span id="quick">-</span></h3>
    <h3>SushiSwap: <span id="sushi">-</span></h3>
    <h3>MeshSwap: <span id="mesh">-</span></h3>
    <h3>Best vs Worst Diff: <span id="diff">-</span></h3>
  </div>

  <script>
    const QUICKSWAP = "0xa5E0829CaCEd8fFDD4De3c43696c57F7D7A678ff";
    const SUSHISWAP = "0x1b02da8cb0d097eb8d57a175b88c7d8b47997506";
    const MESHSWAP  = "0x10f4A785F458Bc144e3706575924889954946639"; // ← Added MeshSwap router
    const USDT = "0xc2132D05D31c914a87C6611C10748AEb04B58e8F";
    const WETH = "0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270"; // POL (Wrapped MATIC)

    const ABI = [
      "function getAmountsOut(uint amountIn, address[] calldata path) external view returns (uint[] memory amounts)"
    ];

    let provider, signer;

    document.getElementById("connect").onclick = async () => {
      if (!window.ethereum) return alert("Install MetaMask");
      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      alert("Connected to MetaMask!");
    };

    document.getElementById("check").onclick = async () => {
      if (!provider) return alert("Please connect MetaMask first");
      try {
        const quick = new ethers.Contract(QUICKSWAP, ABI, provider);
        const sushi = new ethers.Contract(SUSHISWAP, ABI, provider);
        const mesh  = new ethers.Contract(MESHSWAP, ABI, provider); // ← New

        const amountIn = ethers.utils.parseEther("1"); // 1 POL
        const path = [WETH, USDT];

        const qAmounts = await quick.getAmountsOut(amountIn, path);
        const sAmounts = await sushi.getAmountsOut(amountIn, path);
        const mAmounts = await mesh.getAmountsOut(amountIn, path); // ← New

        const quickPrice = parseFloat(ethers.utils.formatUnits(qAmounts[1], 6));
        const sushiPrice = parseFloat(ethers.utils.formatUnits(sAmounts[1], 6));
        const meshPrice  = parseFloat(ethers.utils.formatUnits(mAmounts[1], 6)); // ← New

        // Find min and max for diff
        const prices = [quickPrice, sushiPrice, meshPrice];
        const maxPrice = Math.max(...prices);
        const minPrice = Math.min(...prices);
        const diffPerc = ((maxPrice - minPrice) / minPrice) * 100;

        document.getElementById("quick").innerText = `${quickPrice.toFixed(4)} USDT`;
        document.getElementById("sushi").innerText = `${sushiPrice.toFixed(4)} USDT`;
        document.getElementById("mesh").innerText  = `${meshPrice.toFixed(4)} USDT`; // ← New
        document.getElementById("diff").innerText =
          `${diffPerc.toFixed(3)}% (Best: ${maxPrice.toFixed(4)}, Worst: ${minPrice.toFixed(4)})`;

      } catch (err) {
        console.error(err);
        alert("Error fetching prices. Make sure you're on Polygon Mainnet.");
      }
    };
  </script>
</body>
</html>
