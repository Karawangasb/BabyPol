<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>POL Arbitrage — Multi Pair (USDT / WETH / BNB / BTC)</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body style="font-family: Arial; margin: 20px;">
  <h2>POL Arbitrage — Multi Pair Checker (QuickSwap, SushiSwap, MeshSwap)</h2>

  <label>Choose Pair:</label>
  <select id="pair">
    <option value="USDT">POL / USDT</option>
    <option value="WETH">POL / WETH</option>
    <option value="BNB">POL / BNB</option>
    <option value="SOL">POL / BTC</option>
  </select>
  <br><br>

  <button id="connect">Connect MetaMask</button>
  <button id="check">Check Prices</button>

  <div style="margin-top:20px;">
    <h3>QuickSwap:</h3>
    <p>Sell POL → <span id="quote1">-</span>: <span id="quick_sell">-</span></p>
    <p>Buy POL ← <span id="quote2">-</span>: <span id="quick_buy">-</span></p>

    <h3>SushiSwap:</h3>
    <p>Sell POL → <span id="quote3">-</span>: <span id="sushi_sell">-</span></p>
    <p>Buy POL ← <span id="quote4">-</span>: <span id="sushi_buy">-</span></p>

    <h3>MeshSwap:</h3>
    <p>Sell POL → <span id="quote5">-</span>: <span id="mesh_sell">-</span></p>
    <p>Buy POL ← <span id="quote6">-</span>: <span id="mesh_buy">-</span></p>

    <hr>
    <h3>Arbitrage Opportunities:</h3>
    <p id="arb">-</p>
  </div>

  <script>
    // DEX Routers
    const QUICKSWAP = "0xa5E0829CaCEd8fFDD4De3c43696c57F7D7A678ff";
    const SUSHISWAP = "0x1b02da8cb0d097eb8d57a175b88c7d8b47997506";
    const MESHSWAP  = "0x10f4A785F458Bc144e3706575924889954946639";

    // Polygon token addresses
    const TOKENS = {
      POL:  "0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270", // Wrapped POL (WMATIC)
      USDT: "0xc2132D05D31c914a87C6611C10748AEb04B58e8F",
      WETH: "0x7ceB23fD6bC0adD59E62ac25578270cFf1b9f619",
      BNB:  "0x3BA4c387f786bFEE076A58914F5Bd38d668B42c3",
      BTC:  "0x1BFD67037B42Cf73acF2047067bd4F2C47D9BfD6"
    };

    const ABI = [
      "function getAmountsOut(uint amountIn, address[] calldata path) external view returns (uint[] memory amounts)"
    ];

    let provider, signer;

    document.getElementById("connect").onclick = async () => {
      if (!window.ethereum) return alert("Install MetaMask");
      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      alert("Connected to MetaMask!");
    };

    document.getElementById("check").onclick = async () => {
      if (!provider) return alert("Please connect MetaMask first");

      const pair = document.getElementById("pair").value;
      const quoteToken = TOKENS[pair];
      const POL = TOKENS.POL;

      // Update label
      document.getElementById("quote1").innerText =
      document.getElementById("quote2").innerText =
      document.getElementById("quote3").innerText =
      document.getElementById("quote4").innerText =
      document.getElementById("quote5").innerText =
      document.getElementById("quote6").innerText = pair;

      try {
        const quick = new ethers.Contract(QUICKSWAP, ABI, provider);
        const sushi = new ethers.Contract(SUSHISWAP, ABI, provider);
        const mesh  = new ethers.Contract(MESHSWAP,  ABI, provider);

        const amountPOL = ethers.utils.parseEther("1"); // 1 POL
        const amountQuote = ethers.utils.parseEther("1"); // assume 18 decimals

        // Jalur POL -> quote (jual)
        const pathSell = [POL, quoteToken];
        // Jalur quote -> POL (beli)
        const pathBuy = [quoteToken, POL];

        const [qSell, qBuy, sSell, sBuy, mSell, mBuy] = await Promise.all([
          quick.getAmountsOut(amountPOL, pathSell),
          quick.getAmountsOut(amountQuote, pathBuy),
          sushi.getAmountsOut(amountPOL, pathSell),
          sushi.getAmountsOut(amountQuote, pathBuy),
          mesh.getAmountsOut(amountPOL, pathSell),
          mesh.getAmountsOut(amountQuote, pathBuy)
        ]);

        const decimals = (pair === "USDT") ? 6 : 18;

        const quickSell = parseFloat(ethers.utils.formatUnits(qSell[1], decimals));
        const quickBuy  = 1 / parseFloat(ethers.utils.formatEther(qBuy[1]));
        const sushiSell = parseFloat(ethers.utils.formatUnits(sSell[1], decimals));
        const sushiBuy  = 1 / parseFloat(ethers.utils.formatEther(sBuy[1]));
        const meshSell  = parseFloat(ethers.utils.formatUnits(mSell[1], decimals));
        const meshBuy   = 1 / parseFloat(ethers.utils.formatEther(mBuy[1]));

        document.getElementById("quick_sell").innerText = quickSell.toFixed(6);
        document.getElementById("quick_buy").innerText  = quickBuy.toFixed(6);
        document.getElementById("sushi_sell").innerText = sushiSell.toFixed(6);
        document.getElementById("sushi_buy").innerText  = sushiBuy.toFixed(6);
        document.getElementById("mesh_sell").innerText  = meshSell.toFixed(6);
        document.getElementById("mesh_buy").innerText   = meshBuy.toFixed(6);

        const sellPrices = [
          { name: "QuickSwap", price: quickSell },
          { name: "SushiSwap", price: sushiSell },
          { name: "MeshSwap",  price: meshSell }
        ];
        const buyPrices = [
          { name: "QuickSwap", price: quickBuy },
          { name: "SushiSwap", price: sushiBuy },
          { name: "MeshSwap",  price: meshBuy }
        ];

        const bestSell = sellPrices.reduce((a, b) => a.price > b.price ? a : b);
        const bestBuy  = buyPrices.reduce((a, b) => a.price < b.price ? a : b);
        const diffPct  = ((bestSell.price - bestBuy.price) / bestBuy.price) * 100;

        document.getElementById("arb").innerText =
          diffPct > 0.05
            ? `Buy on ${bestBuy.name}, Sell on ${bestSell.name} — ${pair} profit ≈ ${diffPct.toFixed(3)}%`
            : "No significant arbitrage opportunity.";

      } catch (err) {
        console.error(err);
        alert("Error fetching prices. Make sure you're on Polygon Mainnet.");
      }
    };
  </script>
</body>
</html>
