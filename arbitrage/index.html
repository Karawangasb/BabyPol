<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>POL-Based Arbitrage Scanner</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: Arial; margin: 20px; }
    .log { 
      background: #f1f1f1; 
      padding: 10px; 
      margin-top: 10px; 
      font-size: 12px; 
      max-height: 200px; 
      overflow-y: auto; 
      border: 1px solid #ccc;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 16px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    .profit { background: #d4edda; }
  </style>
</head>
<body>
  <h2>üåÄ Arbitrage Scanner ‚Äî Modal: 1 POL</h2>
  <button id="scan">Scan Sekarang</button>
  
  <div id="result"></div>
  <div class="log" id="log">‚ÑπÔ∏è Log akan muncul di sini...</div>

  <script type="module">
    import { scanTriangularArbitrage } from "./core/scanner.js";

    const logEl = document.getElementById("log");
    const resultEl = document.getElementById("result");

    function log(msg) {
      console.log(msg);
      logEl.innerHTML += `<div>${new Date().toLocaleTimeString()} - ${msg}</div>`;
      logEl.scrollTop = logEl.scrollHeight; // auto-scroll
    }

    document.getElementById("scan").onclick = async () => {
      resultEl.innerHTML = "";
      logEl.innerHTML = ""; // clear log
      log("üîç Memulai pemindaian arbitrase...");

      try {
        const results = await scanTriangularArbitrage(1.0, log); // kirim fungsi log ke scanner
        if (results.length === 0) {
          resultEl.innerHTML = "<p>‚ùå Tidak ada peluang ‚â•1% ditemukan.</p>";
        } else {
          let html = `<h3>Ditemukan ${results.length} peluang:</h3><table>
            <tr><th>DEX</th><th>Path</th><th>Akhir (POL)</th><th>Profit (%)</th></tr>`;
          for (const r of results) {
            html += `<tr class="profit">
              <td>${r.dex}</td>
              <td>${r.path}</td>
              <td>${r.finalPOL}</td>
              <td>+${r.profitPct}%</td>
            </tr>`;
          }
          html += "</table>";
          resultEl.innerHTML = html;
        }
        log("‚úÖ Pemindaian selesai.");
      } catch (err) {
        log(`‚ùå Error utama: ${err.message || err}`);
        resultEl.innerHTML = `<p>‚ö†Ô∏è Error: ${err.message || 'Lihat log di bawah'}</p>`;
      }
    };
  </script>
</body>
</html>
